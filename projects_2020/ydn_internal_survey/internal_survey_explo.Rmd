---
title: "YDN Internal Board of 2022 Survey"
author: "Darwin Do"
date: "12/8/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```


```{r echo=FALSE, message=FALSE, results='hide'}
library(readr)
library(dplyr)
library(tidyr)
library(ggplot2)
library(magrittr)
library(stringr)
library(gridExtra)
```


```{r echo=FALSE, message=FALSE, results='hide'}
d <- read_csv("survey_response.csv")
d %<>% rename(time = names(.)[1], 
              role = names(.)[2],
              loa_fall = names(.)[3],
              new_haven = names(.)[4],
              loa_spring = names(.)[5],
              content = names(.)[6],
              major = names(.)[7],
              race = names(.)[8],
              gender = names(.)[9],
              lgbtq = names(.)[10],
              hometown_type = names(.)[11],
              highschool_type = names(.)[12],
              journalism_exp = names(.)[13],
              international = names(.)[14],
              first_gen_stud = names(.)[15],
              legacy_stud = names(.)[16],
              household_income = names(.)[17],
              finaid = names(.)[18],
              plan_stipend = names(.)[19],
              comfortable = names(.)[20],
              report_comfort = names(.)[21])
```

# General Student Demographics
### Gender Breakdown

```{r}
# gender
d %>%
  group_by(gender) %>%
  summarise(num = n()) %>%
  arrange(desc(gender)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop)- 0.5*prop ) %>%

  ggplot(aes(x = "", y = prop, fill=gender)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + 
  theme_void() +
  geom_text(aes(y = ypos, label = sprintf("%.1f%%", prop)), color = "white", size=6) +
  theme(legend.title = element_blank()) +
  scale_fill_brewer(palette = "Paired") +
  ggtitle("Gender Breakdown") +
  theme(plot.title = element_text(hjust = 0.5))

  #ggsave('gender_breakdown.png')
```


### Race/Ethnicity Breakdown

```{r}

(race_filtered <- d %>%
  separate(race, c('race1','race2', 'race3'), sep = ", ") %>%
  pivot_longer(c('race1', 'race2', 'race3'), values_to = "race") %>%
  filter(!is.na(race)) %>%
  group_by(race) %>%
  summarize(num = n()))
  

# race_filtered %>%
#   ggplot() + 
#   geom_bar(aes(x = race, y = num), stat = "identity") +
#   theme(axis.text.x = element_text(angle = 45, hjust = 1))

race_filtered %>%
  arrange(desc(race)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop) - 0.5 * prop ) %>%

  ggplot(aes(x = "", y = prop, fill=race)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + 
  theme_void() +
  geom_text(aes(y = ypos, x = 1.3, label = sprintf("%.1f%%", prop)), color = "white", size=4) +
  theme(legend.title = element_blank()) +
  scale_fill_brewer(palette = "Paired") +
  ggtitle("Race/Ethnicity Breakdown") +
  theme(plot.title = element_text(hjust = 0.5))
  
  #ggsave('race_breakdown.png')
```

### Hometown Type

```{r}
# hometown
d %>%
  group_by(hometown_type) %>%
  summarise(num = n()) %>%
  arrange(desc(hometown_type)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop) - 0.5 * prop ) %>%

  ggplot(aes(x = "", y = prop, fill=hometown_type)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + 
  theme_void() +
  geom_text(aes(y = ypos, label = sprintf("%.1f%%", prop)), color = "white", size=6) +
  theme(legend.title = element_blank()) +
  scale_fill_brewer(palette = "Paired") +
  ggtitle("Hometown Type") +
  theme(plot.title = element_text(hjust = 0.5))

  #ggsave('hometown_type.png')
```


### Financial Aid and Income Breakdown

```{r}
# Financial Aid Received
(fin_aid_summary <- d %>%
  group_by(finaid) %>%
  summarize(num = n()) %>%
  filter(!is.na(finaid)))

  finaid_plot <- fin_aid_summary %>%
  arrange(desc(finaid)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop) - 0.5 * prop ) %>%
  mutate(lab = paste(round(prop, digits=1), "%", sep = "")) %>%

  ggplot(aes(x = "", y = prop, fill=finaid)) +
  geom_bar(stat="identity", width=1) +
  theme_void() +
  geom_text(aes(y = ypos, x = 1, label = lab), color = "white", size=4) +
  theme(legend.title = element_blank()) +
  ggtitle("Financial Aid Received") +
  theme(plot.title = element_text(hjust = 0.5))


# Income breakdown
# Pretty even split by income
income_breakdown <- d %>%
  group_by(household_income) %>%
  summarize(num = n()) %>%
  filter(!is.na(household_income)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop) - (0.5 * prop)) %>%
  mutate(lab = paste(round(prop, digits=1), "%", sep = ""))
  
  income_plot <- income_breakdown %>%
  ggplot(aes(x = "", y = prop, fill=factor(household_income, levels=c("< $65,000", "$65,000 to $100,000", "$100,000 to $150,000", "$150,000 to $200,000", "$200,000 to $250,000", "$250,000 to $500,000", "> $500,000")))) +
  geom_bar(stat="identity", width=1) +
  theme_void() +
  geom_text(aes(label = lab), position = position_stack(vjust = .5), color = "white", size=4) +
  theme(legend.title = element_blank()) +
  ggtitle("Income Breakdown") +
  theme(plot.title = element_text(hjust = 0.5))


# Putting plots side by side
grid.arrange(finaid_plot, income_plot, nrow = 1, ncol = 2)

# ggsave(file='aid_vs_income.png', g)
```


### Major Breakdown

Almost split even breakdown between major types!
```{r}
(major_filtered <- d %>%
  separate(major, c('major1','major2', 'major3'), sep = ", ") %>%
  pivot_longer(c('major1','major2', 'major3'), values_to = "major") %>%
  filter(!is.na(major)) %>%
  group_by(major) %>%
  summarize(num = n()))

major_filtered %>%
  arrange(desc(major)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop) - 0.5 * prop ) %>%
  mutate(lab = paste(round(prop, digits=2), "%", sep = "")) %>%

  ggplot(aes(x = "", y = prop, fill=major)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + 
  theme_void() +
  geom_text(aes(y = ypos, x = 1, label = lab), color = "white", size=4) +
  theme(legend.title = element_blank()) +
  scale_fill_brewer(palette = "Paired") +
  ggtitle("Major Type") +
  theme(plot.title = element_text(hjust = 0.5))

  #ggsave('major_type.png')
```


### LOA

```{r}
d %>%
  group_by(loa_fall, loa_spring) %>%
  summarize(count = n())
```



### Quick Facts

```{r}
# add column to d dataframe for POC
poc <- c()
for (i in 1:nrow(d)) {
  if (d[i, "race"] %in% c('White')) {
    poc <- c(poc, "No")
  } else {
    poc <- c(poc, "Yes")
  }
}

d["POC"] <- poc

# this sucks lmao

simple_stats_filtered <- d %>%
  select(lgbtq, journalism_exp, international, first_gen_stud, legacy_stud, POC)

simple_stats <- tibble(type = NA, ans = NA, count = NA)

for (i in 1:6) {
  stat_sum <- simple_stats_filtered %>%
    group_by(type = UQ(sym(names(simple_stats_filtered)[i]))) %>%
    summarise(n = n())
  
  yes_num <- stat_sum %>% 
    filter(type == "Yes") %>% pull()
  
  print(yes_num)
  
  no_num <- stat_sum %>% 
    filter(type == "No") %>% pull()
  
  if (dim(stat_sum)[1] == 3) {
    na_num <- stat_sum %>%
      filter(is.na(type)) %>% pull
  } else {
    na_num <- 0
  }
  

  
  type_name <- names(simple_stats_filtered)[i]
  

  simple_stats %<>%
    add_row(type = type_name, ans = "Yes", count = yes_num) %>%
    add_row(type = type_name, ans = "No", count = no_num) %>%
    add_row(type = type_name, ans = "NA", count = na_num)
  
}

simple_stats %<>% filter(!is.na(type))

simple_stats %>%
  ggplot() +
  geom_bar(aes(fill=ans, y = count, x = type), position = "fill", stat = "identity")
```


# YDN Specific Statistics
### Respondent Role

```{r}
(role_filtered <- d %>%
  mutate(role = str_replace_all(role, "\\(.*\\)", "")) %>%
  group_by(role) %>%
  summarize(num = n()))

role_filtered %>%
  arrange(desc(role)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop) - 0.5 * prop ) %>%
  mutate(lab = paste(round(prop, digits=2), "%", sep = "")) %>%

  ggplot(aes(x = "", y = prop, fill=role)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + 
  theme_void() +
  geom_text(aes(y = ypos, x = 1, label = lab), color = "white", size=6)


```

### Content

Notes: 
- Less than 50% of respondents indicated they are working on written content
```{r}
(content_filtered <- d %>%
  mutate(content = str_replace_all(content, "\\(business, tech, outreach\\)", "")) %>%
  separate(content, c('content1','content2', 'content3'), sep = ", ") %>%
  pivot_longer(c('content1', 'content2', 'content3'), values_to = "content") %>%
  filter(!is.na(content)) %>%
  group_by(content) %>%
  summarize(num = n()))

content_filtered %>%
  arrange(desc(content)) %>%
  mutate(prop = num / sum(num) *100) %>%
  mutate(ypos = cumsum(prop) - 0.5 * prop ) %>%
  mutate(lab = paste(round(prop, digits=2), "%", sep = "")) %>%

  ggplot(aes(x = "", y = prop, fill=content)) +
  geom_bar(stat="identity", width=1) +
  coord_polar("y", start=0) + 
  theme_void() +
  geom_text(aes(y = ypos, x = 1, label = lab), color = "white", size=4)
```


# Comfortable at YDN?

```{r}
d %>% 
  ggplot() +
  geom_bar(aes(x = comfortable)) + 
  ylim(0, 90)

d %>%
  ggplot() + 
  geom_bar(aes(x = report_comfort)) + 
  ylim(0, 90)

# look at comfort at ydn across income
d %>%
  filter(!is.na(finaid) & comfortable != 2) %>%
  ggplot() +
  geom_bar(aes(x = comfortable, fill = household_income), position = "fill")
```



# More advanced stuff

```{r}

content_major <- d %>%
  separate(major, c('major1','major2', 'major3'), sep = ", ") %>%
  pivot_longer(c('major1','major2', 'major3'), values_to = "major", names_to = "major_option_name") %>%
  filter(!is.na(major)) %>%
  mutate(content = str_replace_all(content, "\\(business, tech, outreach\\)", "")) %>%
  separate(content, c('content1','content2', 'content3'), sep = ", ") %>%
  pivot_longer(c('content1', 'content2', 'content3'), values_to = "content", names_to = "content_option_name") %>%
  filter(!is.na(content)) 

content_major %>%
  ggplot() +
  geom_bar(aes(x = major, fill = content), position = "fill")

major_n_tbl <- content_major %>%
  group_by(major) %>%
  summarize(major_n = n())
  

content_major %>% 
  group_by(major, content) %>%
  summarize(n = n()) %>%
  left_join(major_n_tbl) %>%
  mutate(pct = n / major_n * 100)

```

```{r}
content_exp <- d %>%
  mutate(content = str_replace_all(content, "\\(business, tech, outreach\\)", "")) %>%
  separate(content, c('content1','content2', 'content3'), sep = ", ") %>%
  pivot_longer(c('content1', 'content2', 'content3'), values_to = "content") %>%
  filter(!is.na(content))

content_exp %>%
  ggplot() +
  geom_bar(aes(x = journalism_exp, fill = content), position = "fill")

content_n_tbl <- content_exp %>%
  group_by(content) %>%
  summarize(content_n = n())

content_exp %>%
  group_by(journalism_exp, content) %>%
  summarize(n = n()) %>%
  left_join(content_n_tbl) %>%
  mutate(pct = n / content_n * 100)
```


NOTES:
Look at major by content

